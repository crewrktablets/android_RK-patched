--- /home/netlars/android/source/cm-10.1/external/bluetooth/bluedroid/btif/src/btif_core.c
+++ /home/netlars/android/source/crew-cm-10.1/android/external/bluetooth/bluedroid/btif/src/btif_core.c
@@ -345,8 +345,33 @@
     int val_size = 0;
     const uint8_t null_bdaddr[BD_ADDR_LEN] = {0,0,0,0,0,0};
 
+    {
+        int vflash_fd = open("/dev/vflash", O_RDONLY);
+        if (vflash_fd > 0)
+        {
+            char bd_addr[6] = {0};
+            BTIF_TRACE_DEBUG0("Get local bdaddr from vflash");
+            #define VFLASH_READ_BDA  0x01
+            if(ioctl(vflash_fd, VFLASH_READ_BDA, (unsigned long)bd_addr) >= 0
+                && memcmp(bd_addr, null_bdaddr, BD_ADDR_LEN) != 0)
+            {
+                local_addr->address[0] = bd_addr[5];
+                local_addr->address[1] = bd_addr[4];
+                local_addr->address[2] = bd_addr[3];
+                local_addr->address[3] = bd_addr[2];
+                local_addr->address[4] = bd_addr[1];
+                local_addr->address[5] = bd_addr[0];
+                valid_bda = TRUE;
+                BTIF_TRACE_DEBUG6("Got Factory BDA %02X:%02X:%02X:%02X:%02X:%02X",
+                    local_addr->address[0], local_addr->address[1], local_addr->address[2],
+                    local_addr->address[3], local_addr->address[4], local_addr->address[5]);
+            }
+            close(vflash_fd);
+        }
+    }
+
     /* Get local bdaddr storage path from property */
-    if (property_get(PROPERTY_BT_BDADDR_PATH, val, NULL))
+    if (!valid_bda && property_get(PROPERTY_BT_BDADDR_PATH, val, NULL))
     {
         int addr_fd;
 
@@ -400,8 +425,8 @@
         srand((unsigned int) (time(0)));
 
         /* No autogen BDA. Generate one now. */
-        local_addr->address[0] = 0x22;
-        local_addr->address[1] = 0x22;
+        local_addr->address[0] = (uint8_t) ((rand() >> 8) & 0xFF);
+        local_addr->address[1] = (uint8_t) ((rand() >> 8) & 0xFF);
         local_addr->address[2] = (uint8_t) ((rand() >> 8) & 0xFF);
         local_addr->address[3] = (uint8_t) ((rand() >> 8) & 0xFF);
         local_addr->address[4] = (uint8_t) ((rand() >> 8) & 0xFF);
